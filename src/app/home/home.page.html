<ion-header [translucent]="true" class="fritos-header">
  <ion-toolbar color="fritos-red">
    <ion-title class="fritos-logo titulo">
      LOS FRITOS HERMANOS
    </ion-title>
    <ion-buttons slot="end" *ngIf="nombreUsuario">
      <ion-button (click)="cerrarSesion()" color="light" class="logout-button">
        <ion-icon name="log-out-outline" slot="start"></ion-icon>
        Cerrar Sesión
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="fritos-theme">
  <ion-header collapse="condense">
    <ion-toolbar color="fritos-red">
      <ion-title size="large" class="fritos-logo">LOS FRITOS HERMANOS</ion-title>
    </ion-toolbar>
  </ion-header>


  <div id="container" class="fritos-card" *ngIf="!nombreUsuario">
    <img src="https://jpwlvaprtxszeimmimlq.supabase.co/storage/v1/object/public/FritosHermanos/crispy2.png" alt="Logo" class="login-logo fritos-bounce" />
    <strong class="fritos-logo">¡Bienvenido a Los Fritos Hermanos!</strong>
    <p class="fritos-subtitle">Tu aplicación de comida rápida favorita</p>
    <ion-button color="fritos-red" class="fritos-button" routerLink="/login">
      Iniciar Sesión
    </ion-button>
  </div>

 
  <div id="container" class="fritos-card" *ngIf="nombreUsuario">
    <img src="https://jpwlvaprtxszeimmimlq.supabase.co/storage/v1/object/public/FritosHermanos/crispy2.png" alt="Logo" class="login-logo fritos-bounce" />
    <strong class="fritos-logo">¡Bienvenido, {{ nombreUsuario }}!</strong>
    <p class="fritos-subtitle">Perfil: {{ tipoUsuario | titlecase }}</p>

  
    <div *ngIf="tipoUsuario === 'dueño' || tipoUsuario === 'supervisor'" class="admin-options">
      <h3 class="fritos-subtitle">Panel de Administración</h3>
      
      <ion-button expand="block" color="fritos-blue" class="fritos-button" (click)="irARegistro('/registro-empleados')">
        <ion-icon name="person-add-outline" slot="start"></ion-icon>
        Registrar Empleado
      </ion-button>

      <ion-button expand="block" color="fritos-orange" class="fritos-button" (click)="irARegistro('/registro-mesa')">
        <ion-icon name="restaurant-outline" slot="start"></ion-icon>
        Registrar Mesa
      </ion-button>

      <ion-button expand="block" color="fritos-orange" class="fritos-button" (click)="irAAprobacionClientes()">
        <ion-icon name="checkmark-circle-outline" slot="start"></ion-icon>
        Aprobar Clientes
      </ion-button>

    </div>

    <div *ngIf="esMaitre && !esAdmin" class="maitre-options">
      <h3 class="fritos-subtitle">Panel de Maître</h3>
      
      <ion-button expand="block" color="fritos-blue" class="fritos-button" (click)="irARegistro('/registro')">
        <ion-icon name="person-add-outline" slot="start"></ion-icon>
        Registrar Cliente
      </ion-button>

      <ion-button expand="block" color="fritos-orange" class="fritos-button" (click)="irAMaitreMesas()">
        <ion-icon name="restaurant-outline" slot="start"></ion-icon>
        Gestionar Mesas
      </ion-button>

      <ion-button 
        *ngIf="perfilUsuario === 'maitre'" 
        expand="block" 
        class="btn-pedidos"
        (click)="irAListaEspera()">
        <div class="boton-contenido-columna">
          <ion-icon name="list-outline"></ion-icon>
          <span class="boton-texto">Lista de Espera</span>
        </div>
      </ion-button>
    </div>

 
    <div *ngIf="tipoUsuario === 'cocinero'" class="cocinero-options">
      <h3 class="fritos-subtitle">Panel de Cocinero</h3>
      
      <ion-button expand="block" color="fritos-blue" class="fritos-button" (click)="irARegistro('/registro-plato')">
        <ion-icon name="restaurant-outline" slot="start"></ion-icon>
        Registrar Producto
      </ion-button>

      <ion-button expand="block" color="fritos-orange" class="fritos-button" (click)="irAVerPedidosCocina()">
        <ion-icon name="list-outline" slot="start" ></ion-icon>
        Ver Pedidos
      </ion-button>
    </div>

    <div *ngIf="tipoUsuario === 'bartender'" class="bartender-options">
      <h3 class="fritos-subtitle">Panel de Bartender</h3>
      
      <ion-button expand="block" color="fritos-blue" class="fritos-button" [routerLink]="['/bebidas']" routerLinkActive="router-link-active" >
        <ion-icon name="wine-outline" slot="start"></ion-icon>
        Registrar Bebida
      </ion-button>

      <ion-button expand="block" color="fritos-orange" class="fritos-button">
        <ion-icon name="list-outline" slot="start"></ion-icon>
        Ver Pedidos
      </ion-button>
    </div>

    <div *ngIf="tipoUsuario === 'mozo'" class="mozo-options">
      <h3 class="fritos-subtitle">Panel de Mozo</h3>
      
      <ion-button expand="block" color="fritos-blue" class="fritos-button" (click)="irAPedidosMozo()">
        <ion-icon name="clipboard-outline" slot="start"></ion-icon>
        Ver Pedidos Pendientes
      </ion-button>

      <ion-button expand="block" color="fritos-green" class="fritos-button" (click)="irAConsultasMozo()">
        <ion-icon name="chatbubbles-outline" slot="start"></ion-icon>
        Ver Consultas de Clientes
      </ion-button>
    </div>

    <div *ngIf="tipoUsuario === 'cliente'" class="cliente-options">
      <h3 class="fritos-subtitle">Panel de Cliente</h3>
      
      <ion-button expand="block" color="fritos-blue" class="fritos-button" [routerLink]="['/menu']">
        <ion-icon name="restaurant-outline" slot="start"></ion-icon>
        Ver Menú
      </ion-button>

      @if (tipoUsuario === 'cliente' && mostrarBotonEscanearMesa && !clienteSentado)
      {
        <ion-button
        expand="block" color="fritos-orange" class="fritos-button" (click)="escanearMesaAsignada()">
          <ion-icon name="qr-code-outline" slot="start"></ion-icon>
          Escanear QR Mesa
        </ion-button>
      }
      
      <ion-button 
      *ngIf="perfilUsuario === 'cliente' && mostrarBotonHacerPedido" 
      expand="block" 
      class="btn-pedidos btn-solicitar-mesa"
      (click)="escanearQRParaMenu()">
      <div class="boton-contenido-columna">
        <ion-icon name="qr-code-outline"></ion-icon>
        <span class="boton-texto">HACER PEDIDO</span>
      </div>
      </ion-button>

      @if (perfilUsuario === 'cliente' && pedidoActualCliente?.recepcion && pedidoActualCliente?.cuenta === 'pedida' && !clienteInfo?.encuesta)
      {
        <ion-button expand="block" color="fritos-red" class="fritos-button" (click)="irAEncuestas()">
          <ion-icon name="chatbubbles-outline" slot="start"></ion-icon>
          Encuestas
        </ion-button>
  
        <ion-button expand="block" color="fritos-green" class="fritos-button" (click)="irAJuegos()">
          <ion-icon name="game-controller-outline" slot="start"></ion-icon>
          Juegos
        </ion-button>
      }

      @if(perfilUsuario === 'cliente' && !yaEnListaEspera && !clienteSentado)
      {
        <ion-button 
          *ngIf="perfilUsuario === 'cliente' && !yaEnListaEspera && !clienteSentado" 
          expand="block" 
          class="btn-pedidos btn-solicitar-mesa"
          (click)="escanearQR()">
          <div class="boton-contenido-columna">
            <ion-icon name="qr-code-outline"></ion-icon>
            <span class="boton-texto">SOLICITAR MESA</span>
          </div>
        </ion-button>


      }




      <ion-modal [isOpen]="mostrarModalConsultasMozo" (didDismiss)="cerrarModalConsultasMozo()">
    <ng-template>
      <ion-content>
        <div class="modal-title-container">
          <ion-button fill="clear" class="close-button" (click)="cerrarModalConsultasMozo()">
            <ion-icon name="close"></ion-icon>
          </ion-button>
          <h2 class="modal-title">Consultas de clientes</h2>
        </div>
        <div class="clientes-container">
          <div *ngIf="cargandoConsultasMozo" class="loading-container"><p>Cargando consultas...</p></div>
          <div *ngIf="!cargandoConsultasMozo && consultasMozo.length === 0" class="modal-empty">No hay consultas.</div>
          <div *ngFor="let consulta of consultasMozo" class="cliente-item">
            <div class="cliente-info">
              <div class="cliente-nombre" style="display: flex; justify-content: center; width: 100%;">Mesa N° {{ consulta.mesa }}</div>
              <div class="cliente-meta">{{ formatearHoraConsulta(consulta.hora) }}</div>
              <div class="cliente-correo">{{ consulta.consulta }}</div>
            </div>
            <div class="mesa-actions">
              <ng-container *ngIf="!consulta.respuesta">
                <ion-button *ngIf="mostrarRespuestaId !== consulta.id" fill="outline" color="success" size="small" (click)="mostrarRespuestaId = consulta.id">
                  <ion-icon name="chatbox-ellipses" slot="start"></ion-icon>
                  Responder
                </ion-button>
                <div *ngIf="mostrarRespuestaId === consulta.id" class="respuesta-form">
                  <textarea [(ngModel)]="respuestaMozoPorId[consulta.id]" placeholder="Escribe tu respuesta..." rows="2"></textarea>
                  <div *ngIf="errorRespuestaMozoPorId[consulta.id]" class="error-consulta-mozo">{{ errorRespuestaMozoPorId[consulta.id] }}</div>
                  <ion-button class="btn-accion btn-confirmar" color="success" (click)="enviarRespuestaMozo(consulta)" [disabled]="!respuestaMozoPorId[consulta.id] || !respuestaMozoPorId[consulta.id].trim()">Enviar</ion-button>
                  <ion-button fill="clear" color="danger" size="small" (click)="mostrarRespuestaId = null">Cancelar</ion-button>
                </div>
              </ng-container>
              <div *ngIf="consulta.respuesta" class="respuesta-mozo">
                <div class="respuesta-label">Respuesta del mozo:</div>
                <div class="respuesta-texto">{{ consulta.respuesta }}</div>
                <div class="respuesta-meta">Por: {{ consulta.mozo }} | {{ formatearHoraConsulta(consulta.hora_respuesta) }}</div>
              </div>
            </div>
          </div>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>

    </div>
  </div>
</ion-content>