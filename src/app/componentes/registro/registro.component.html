<ion-content class="register-page fritos-theme" fullscreen="true" [scrollEvents]="true" scroll="true">
  <div class="center-wrapper">
    <div class="register-container fritos-card">
      <img src="https://jpwlvaprtxszeimmimlq.supabase.co/storage/v1/object/public/FritosHermanos/crispy2.png" alt="Logo" class="login-logo fritos-bounce" />
      <h2 class="register-subtitle fritos-logo">¡BIENVENIDO!</h2>

      <form *ngIf="tipoRegistro==='empleado'" [formGroup]="empleadoForm" (ngSubmit)="registrarEmpleado()">
        <ion-item>
          <ion-icon slot="start" name="person-outline"></ion-icon>
          <ion-label position="floating">Nombre</ion-label>
          <ion-input formControlName="nombre"></ion-input>
        </ion-item>
        <div class="field-error" *ngIf="empleadoNombreError">{{ empleadoNombreError }}</div>

        <ion-item>
          <ion-icon slot="start" name="person-outline"></ion-icon>
          <ion-label position="floating">Apellido</ion-label>
          <ion-input formControlName="apellido"></ion-input>
        </ion-item>
        <div class="field-error" *ngIf="empleadoApellidoError">{{ empleadoApellidoError }}</div>

        <ion-item>
          <ion-icon slot="start" name="mail-outline"></ion-icon>
          <ion-label position="floating">Correo electrónico</ion-label>
          <ion-input type="email" formControlName="correo"></ion-input>
        </ion-item>
        <div class="field-error" *ngIf="empleadoCorreoError">{{ empleadoCorreoError }}</div>
        
        <ion-item>
          <ion-icon slot="start" name="lock-closed-outline"></ion-icon>
          <ion-label position="floating">Contraseña</ion-label>
          <ion-input type="password" formControlName="contrasenia"></ion-input>
        </ion-item>
        <div class="field-error" *ngIf="empleadoContraseniaError">{{ empleadoContraseniaError }}</div>

        <ion-item>
          <ion-icon slot="start" name="card-outline"></ion-icon>
          <ion-label position="floating">DNI</ion-label>
          <ion-input type="text" formControlName="dni"></ion-input>
          <ion-button slot="end" size="small" class="boton-verde" (click)="escanearDNI()">
            Escanear
          </ion-button>
        </ion-item>
        <div class="field-error" *ngIf="empleadoDniError">{{ empleadoDniError }}</div>

        <ion-item>
          <ion-icon slot="start" name="card-outline"></ion-icon>
          <ion-label position="floating">CUIL</ion-label>
          <ion-input type="text" formControlName="cuil"></ion-input>
        </ion-item>
        <div class="field-error" *ngIf="empleadoCuilError">{{ empleadoCuilError }}</div>

        <ion-item lines="none">
          <ion-icon slot="start" name="person-circle-outline"></ion-icon>
          <ion-label>Perfil del empleado:</ion-label>
          <div class="perfil-empleado-container">
            <!-- Primera fila -->
            <div class="perfil-fila">
              <div class="perfil-opcion">
                <ion-checkbox
                  [checked]="empleadoForm.get('perfil')?.value === 'cocinero'"
                  (ionChange)="empleadoForm.get('perfil')?.setValue('cocinero')"
                ></ion-checkbox>
                <span class="texto-perfil">Cocinero</span>
              </div>
              <div class="perfil-opcion">
                <ion-checkbox
                  [checked]="empleadoForm.get('perfil')?.value === 'bartender'"
                  (ionChange)="empleadoForm.get('perfil')?.setValue('bartender')"
                ></ion-checkbox>
                <span class="texto-perfil">Bartender</span>
              </div>
            </div>
            <!-- Segunda fila -->
            <div class="perfil-fila">
              <div class="perfil-opcion">
                <ion-checkbox
                  [checked]="empleadoForm.get('perfil')?.value === 'mozo'"
                  (ionChange)="empleadoForm.get('perfil')?.setValue('mozo')"
                ></ion-checkbox>
                <span class="texto-perfil">Mozo</span>
              </div>
              <div class="perfil-opcion">
                <ion-checkbox
                  [checked]="empleadoForm.get('perfil')?.value === 'maitre'"
                  (ionChange)="empleadoForm.get('perfil')?.setValue('maitre')"
                ></ion-checkbox>
                <span class="texto-perfil">Maitre</span>
              </div>
            </div>
          </div>
        </ion-item>
        <div class="field-error" *ngIf="empleadoPerfilError">{{ empleadoPerfilError }}</div>

        <ion-item>
          <ion-icon slot="start" name="camera-outline"></ion-icon>
          <ion-label>Foto</ion-label>
          <ion-button slot="end" size="small" class="boton-verde" (click)="tomarFoto()">Tomar Foto</ion-button>
        </ion-item>
        <div class="field-error" *ngIf="empleadoImagenError">{{ empleadoImagenError }}</div>

        <div *ngIf="imagenEmpleadoURL" class="imagen-preview-única">
          <ion-label>Vista previa:</ion-label>
          <div class="preview-wrapper">
            <img [src]="imagenEmpleadoURL" alt="Preview" style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px;"/>
          </div>
        </div>

        <div class="error-message" *ngIf="mensajeError">{{ mensajeError }}</div>

        <ion-button expand="block" type="submit" [disabled]="empleadoForm.invalid">
          REGISTRAR EMPLEADO
        </ion-button>

        <div *ngIf="mensajeExito" class="mensaje-exito">
          {{ mensajeExito }}
        </div>
      </form>

  
      <form *ngIf="tipoRegistro==='supervisor'" [formGroup]="supervisorForm" (ngSubmit)="registrarSupervisor()">
        <ion-item>
          <ion-icon slot="start" name="person-outline"></ion-icon>
          <ion-label position="floating">Nombre</ion-label>
          <ion-input formControlName="nombre"></ion-input>
        </ion-item>
        <div class="field-error" *ngIf="supervisorNombreError">{{ supervisorNombreError }}</div>

        <ion-item>
          <ion-icon slot="start" name="person-outline"></ion-icon>
          <ion-label position="floating">Apellido</ion-label>
          <ion-input formControlName="apellido"></ion-input>
        </ion-item>
        <div class="field-error" *ngIf="supervisorApellidoError">{{ supervisorApellidoError }}</div>

        <ion-item>
          <ion-icon slot="start" name="mail-outline"></ion-icon>
          <ion-label position="floating">Correo electrónico</ion-label>
          <ion-input type="email" formControlName="correo"></ion-input>
        </ion-item>
        <div class="field-error" *ngIf="supervisorCorreoError">{{ supervisorCorreoError }}</div>
        
        <ion-item>
          <ion-icon slot="start" name="lock-closed-outline"></ion-icon>
          <ion-label position="floating">Contraseña</ion-label>
          <ion-input type="password" formControlName="contrasenia"></ion-input>
        </ion-item>
        <div class="field-error" *ngIf="supervisorContraseniaError">{{ supervisorContraseniaError }}</div>

        <ion-item>
          <ion-icon slot="start" name="card-outline"></ion-icon>
          <ion-label position="floating">DNI</ion-label>
          <ion-input type="text" formControlName="dni"></ion-input>
          <ion-button slot="end" size="small" class="boton-verde" (click)="escanearDNI()">
            Escanear
          </ion-button>
        </ion-item>
        <div class="field-error" *ngIf="supervisorDniError">{{ supervisorDniError }}</div>

        <ion-item>
          <ion-icon slot="start" name="card-outline"></ion-icon>
          <ion-label position="floating">CUIL</ion-label>
          <ion-input type="text" formControlName="cuil"></ion-input>
        </ion-item>
        <div class="field-error" *ngIf="supervisorCuilError">{{ supervisorCuilError }}</div>

        <ion-item lines="none">
          <ion-label>Perfil</ion-label>
          <div class="perfil-checkboxes fila-horizontal">
            <div class="perfil-opcion">
              <ion-checkbox
                [checked]="supervisorForm.get('perfil')?.value === 'dueño'"
                (ionChange)="supervisorForm.get('perfil')?.setValue('dueño')"
              ></ion-checkbox>
              <span class="texto-perfil">Dueño</span>
            </div>
            <div class="perfil-opcion">
              <ion-checkbox
                [checked]="supervisorForm.get('perfil')?.value === 'supervisor'"
                (ionChange)="supervisorForm.get('perfil')?.setValue('supervisor')"
              ></ion-checkbox>
              <span class="texto-perfil">Supervisor</span>
            </div>
          </div>
        </ion-item>
        <div class="field-error" *ngIf="supervisorPerfilError">{{ supervisorPerfilError }}</div>

        <ion-item>
          <ion-icon slot="start" name="camera-outline"></ion-icon>
          <ion-label>Foto</ion-label>
          <ion-button slot="end" size="small" class="boton-verde" (click)="tomarFoto()">Tomar Foto</ion-button>
        </ion-item>
        <div class="field-error" *ngIf="supervisorImagenError">{{ supervisorImagenError }}</div>

        <div *ngIf="imagenSupervisorURL" class="imagen-preview-única">
          <ion-label>Vista previa:</ion-label>
          <div class="preview-wrapper">
            <img [src]="imagenSupervisorURL" alt="Preview" style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px;"/>
          </div>
        </div>

        <div class="error-message" *ngIf="mensajeError">{{ mensajeError }}</div>

        <ion-button expand="block" type="submit" [disabled]="supervisorForm.invalid">
          REGISTRAR SUPERVISOR
        </ion-button>

        <div *ngIf="mensajeExito" class="mensaje-exito">
          {{ mensajeExito }}
        </div>
      </form>


      <!-- BEBIDA O PLATO - Formulario para registro de productos/platos -->
      <form *ngIf="tipoRegistro==='producto'" [formGroup]="productoForm" (ngSubmit)="registrarProducto()">
        <!-- BEBIDA O PLATO - Campo nombre del plato -->
        <ion-item>
          <ion-icon slot="start" name="restaurant-outline"></ion-icon>
          <ion-label position="floating">Nombre del plato</ion-label>
          <ion-input formControlName="nombre"></ion-input>
        </ion-item>
        <div class="field-error" *ngIf="productoNombreError">{{ productoNombreError }}</div>

        <!-- BEBIDA O PLATO - Campo descripción del plato -->
        <ion-item>
          <ion-icon slot="start" name="document-text-outline"></ion-icon>
          <ion-label position="floating">Descripción</ion-label>
          <ion-textarea formControlName="descripcion" rows="3" placeholder="Describe el plato..."></ion-textarea>
        </ion-item>
        <div class="field-error" *ngIf="productoDescripcionError">{{ productoDescripcionError }}</div>

        <!-- BEBIDA O PLATO - Campo tiempo de elaboración del plato -->
        <ion-item>
          <ion-icon slot="start" name="time-outline"></ion-icon>
          <ion-label position="floating">Tiempo de elaboración (minutos)</ion-label>
          <ion-input type="number" formControlName="tiempoElaboracion" min="1" max="60"></ion-input>
        </ion-item>
        <div class="field-error" *ngIf="productoTiempoError">{{ productoTiempoError }}</div>

        <!-- BEBIDA O PLATO - Campo precio del plato -->
        <ion-item>
          <ion-icon slot="start" name="cash-outline"></ion-icon>
          <ion-label position="floating">Precio ($)</ion-label>
          <ion-input type="number" step="0.01" formControlName="precio"></ion-input>
        </ion-item>
        <div class="field-error" *ngIf="productoPrecioError">{{ productoPrecioError }}</div>

        <!-- BEBIDA O PLATO - Botón para tomar fotos del plato -->
        <ion-item>
          <ion-icon slot="start" name="images-outline"></ion-icon>
          <ion-button slot="end" size="small" class="boton-verde" (click)="tomarFoto()">Tomar Fotos</ion-button>
        </ion-item>
        <div class="field-error" *ngIf="productoImagenesError">{{ productoImagenesError }}</div>

        <!-- BEBIDA O PLATO - Preview de imágenes del plato -->
        <div *ngIf="imagenesProductoURLs.length > 0" class="imagenes-preview">
          <ion-label>Vista previa de imágenes ({{ imagenesProductoArchivos.length }}/3):</ion-label>
          <div class="imagenes-grid">
            <div *ngFor="let imagen of imagenesProductoURLs; let i = index" class="imagen-preview">
              <img [src]="imagen" alt="Preview" />
              <span class="imagen-numero">{{ i + 1 }}</span>
            </div>
          </div>
        </div>

        <div class="error-message" *ngIf="mensajeError">{{ mensajeError }}</div>

        <!-- BEBIDA O PLATO - Botón para registrar plato -->
        <ion-button expand="block" type="submit" [disabled]="productoForm.invalid">
          REGISTRAR PLATO
        </ion-button>

        <div *ngIf="mensajeExito" class="mensaje-exito">
          {{ mensajeExito }}
        </div>
      </form>

      <!-- BEBIDA O PLATO - Formulario para registro de bebidas -->
      <form *ngIf="tipoRegistro==='bebida'" [formGroup]="bebidaForm" (ngSubmit)="registrarBebida()">
        <!-- BEBIDA O PLATO - Campo nombre de la bebida -->
        <ion-item>
          <ion-icon slot="start" name="wine-outline"></ion-icon>
          <ion-label position="floating">Nombre de la bebida</ion-label>
          <ion-input formControlName="nombre"></ion-input>
        </ion-item>
        <div class="field-error" *ngIf="bebidaNombreError">{{ bebidaNombreError }}</div>

        <!-- BEBIDA O PLATO - Campo descripción de la bebida -->
        <ion-item>
          <ion-icon slot="start" name="document-text-outline"></ion-icon>
          <ion-label position="floating">Descripción</ion-label>
          <ion-textarea formControlName="descripcion" rows="3" placeholder="Describe la bebida..."></ion-textarea>
        </ion-item>
        <div class="field-error" *ngIf="bebidaDescripcionError">{{ bebidaDescripcionError }}</div>

        <!-- BEBIDA O PLATO - Campo tiempo de elaboración de la bebida -->
        <ion-item>
          <ion-icon slot="start" name="time-outline"></ion-icon>
          <ion-label position="floating">Tiempo de elaboración (minutos)</ion-label>
          <ion-input type="number" formControlName="tiempoElaboracion" min="1" max="60"></ion-input>
        </ion-item>
        <div class="field-error" *ngIf="bebidaTiempoError">{{ bebidaTiempoError }}</div>

        <!-- BEBIDA O PLATO - Campo precio de la bebida -->
        <ion-item>
          <ion-icon slot="start" name="cash-outline"></ion-icon>
          <ion-label position="floating">Precio ($)</ion-label>
          <ion-input type="number" step="0.01" formControlName="precio"></ion-input>
        </ion-item>
        <div class="field-error" *ngIf="bebidaPrecioError">{{ bebidaPrecioError }}</div>

        <!-- BEBIDA O PLATO - Botón para tomar fotos de la bebida -->
        <ion-item>
          <ion-icon slot="start" name="images-outline"></ion-icon>
          <ion-button slot="end" size="small" class="boton-verde" (click)="tomarFoto()">Tomar Fotos</ion-button>
        </ion-item>
        <div class="field-error" *ngIf="bebidaImagenesError">{{ bebidaImagenesError }}</div>

        <!-- BEBIDA O PLATO - Preview de imágenes de la bebida -->
        <div *ngIf="imagenesBebidaURLs.length > 0" class="imagenes-preview">
          <ion-label>Vista previa de imágenes ({{ imagenesBebidaArchivos.length }}/3):</ion-label>
          <div class="imagenes-grid">
            <div *ngFor="let imagen of imagenesBebidaURLs; let i = index" class="imagen-preview">
              <img [src]="imagen" alt="Preview" />
              <span class="imagen-numero">{{ i + 1 }}</span>
            </div>
          </div>
        </div>

        <div class="error-message" *ngIf="mensajeError">{{ mensajeError }}</div>

        <!-- BEBIDA O PLATO - Botón para registrar bebida -->
        <ion-button expand="block" type="submit" [disabled]="bebidaForm.invalid">
          REGISTRAR BEBIDA
        </ion-button>

        <div *ngIf="mensajeExito" class="mensaje-exito">
          {{ mensajeExito }}
        </div>
      </form>

      <form *ngIf="tipoRegistro==='mesa'" [formGroup]="mesaForm" (ngSubmit)="registrarMesa()">
        <ion-item>
          <ion-icon slot="start" name="grid-outline"></ion-icon>
          <ion-label position="floating">Número de mesa</ion-label>
          <ion-input formControlName="numero"></ion-input>
        </ion-item>
        <div class="field-error" *ngIf="mesaNumeroError">{{ mesaNumeroError }}</div>

        <ion-item>
          <ion-icon slot="start" name="people-outline"></ion-icon>
          <ion-label position="floating">Cantidad de comensales</ion-label>
          <ion-input type="number" formControlName="comensales"></ion-input>
        </ion-item>
        <div class="field-error" *ngIf="mesaComensalesError">{{ mesaComensalesError }}</div>

        <ion-item lines="none">
          <ion-label>Tipo de mesa:</ion-label>
          <div class="perfil-checkboxes">
            <label class="checkbox-label">
              <ion-checkbox
                [checked]="mesaForm.get('tipo')?.value === 'estandar'"
                (ionChange)="mesaForm.get('tipo')?.setValue('estandar')"
              ></ion-checkbox>
              <span>Estándar</span>
            </label>
            <label class="checkbox-label">
              <ion-checkbox
                [checked]="mesaForm.get('tipo')?.value === 'vip'"
                (ionChange)="mesaForm.get('tipo')?.setValue('vip')"
              ></ion-checkbox>
              <span>VIP</span>
            </label>
            <label class="checkbox-label">
              <ion-checkbox
                [checked]="mesaForm.get('tipo')?.value === 'discapacitados'"
                (ionChange)="mesaForm.get('tipo')?.setValue('discapacitados')"
              ></ion-checkbox>
              <span>Movilidad reducida</span>
            </label>
          </div>
        </ion-item>
        <div class="field-error" *ngIf="mesaTipoError">{{ mesaTipoError }}</div>

        <ion-item>
          <ion-icon slot="start" name="camera-outline"></ion-icon>
          <ion-label>Foto</ion-label>
          <ion-button slot="end" size="small" class="boton-verde" (click)="tomarFoto()">Tomar Foto</ion-button>
        </ion-item>
        <div class="field-error" *ngIf="mesaImagenError">{{ mesaImagenError }}</div>

        <div *ngIf="imagenMesaURL" class="imagen-preview-única">
          <ion-label>Vista previa:</ion-label>
          <div class="preview-wrapper">
            <img [src]="imagenMesaURL" alt="Preview" style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px;"/>
          </div>
        </div>

        <div *ngIf="qrMesaURL" class="imagen-preview-única">
          <ion-label>QR Generado:</ion-label>
          <div class="preview-wrapper">
            <img [src]="qrMesaURL" alt="QR Code" style="width: 80px; height: 80px;"/>
          </div>
        </div>

        <div class="error-message" *ngIf="mensajeError">{{ mensajeError }}</div>

        <ion-button expand="block" type="submit" [disabled]="mesaForm.invalid">
          REGISTRAR MESA
        </ion-button>

        <div *ngIf="mensajeExito" class="mensaje-exito">
          {{ mensajeExito }}
        </div>
      </form>

      <form *ngIf="tipoRegistro==='cliente'" [formGroup]="clienteForm" (ngSubmit)="registrarCliente()">
        <ion-item>
          <ion-icon slot="start" name="person-outline"></ion-icon>
          <ion-label position="floating">Nombre</ion-label>
          <ion-input formControlName="nombre"></ion-input>
        </ion-item>
        <div class="field-error" *ngIf="clienteNombreError">{{ clienteNombreError }}</div>

        <ion-item>
          <ion-icon slot="start" name="person-outline"></ion-icon>
          <ion-label position="floating">Apellido</ion-label>
          <ion-input formControlName="apellido"></ion-input>
        </ion-item>
        <div class="field-error" *ngIf="clienteApellidoError">{{ clienteApellidoError }}</div>

        <ion-item>
          <ion-icon slot="start" name="mail-outline"></ion-icon>
          <ion-label position="floating">Correo electrónico</ion-label>
          <ion-input type="email" formControlName="correo"></ion-input>
        </ion-item>
        <div class="field-error" *ngIf="clienteCorreoError">{{ clienteCorreoError }}</div>

        <ion-item>
          <ion-icon slot="start" name="lock-closed-outline"></ion-icon>
          <ion-label position="floating">Contraseña</ion-label>
          <ion-input type="password" formControlName="contrasenia"></ion-input>
        </ion-item>
        <div class="field-error" *ngIf="clienteContraseniaError">{{ clienteContraseniaError }}</div>

        <ion-item>
          <ion-icon slot="start" name="card-outline"></ion-icon>
          <ion-label position="floating">DNI</ion-label>
          <ion-input type="text" formControlName="dni"></ion-input>
          <ion-button slot="end" size="small" class="boton-verde" (click)="escanearDNI()">
            Escanear
          </ion-button>
        </ion-item>
        <div class="field-error" *ngIf="clienteDniError">{{ clienteDniError }}</div>

        <ion-item>
          <ion-icon slot="start" name="camera-outline"></ion-icon>
          <ion-label>Foto</ion-label>
          <ion-button slot="end" size="small" class="boton-verde" (click)="tomarFoto()">Tomar Foto</ion-button>
        </ion-item>
        <div class="field-error" *ngIf="clienteImagenError">{{ clienteImagenError }}</div>

        <div *ngIf="imagenClienteURL" class="imagen-preview-única">
          <ion-label>Vista previa:</ion-label>
          <div class="preview-wrapper">
            <img [src]="imagenClienteURL" alt="Preview" style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px;"/>
          </div>
        </div>

        <div class="error-message" *ngIf="mensajeError">{{ mensajeError }}</div>

        <ion-button expand="block" type="submit" [disabled]="clienteForm.invalid">
          REGISTRAR CLIENTE
        </ion-button>

        <div *ngIf="mensajeExito" class="mensaje-exito">
          {{ mensajeExito }}
        </div>
      </form>

      <!-- Selector de tipo de registro condicionado por roles -->
      <div *ngIf="esAdmin && (perfilUsuario === 'dueño' || perfilUsuario === 'supervisor')" class="registro-selector">
        <ion-button size="small" [color]="tipoRegistro==='supervisor' ? 'success' : 'medium'" (click)="setTipoRegistro('supervisor')">Supervisor</ion-button>
        <ion-button size="small" [color]="tipoRegistro==='empleado' ? 'success' : 'medium'" (click)="setTipoRegistro('empleado')">Empleado</ion-button>
        <ion-button size="small" [color]="tipoRegistro==='mesa' ? 'success' : 'medium'" (click)="setTipoRegistro('mesa')">Mesa</ion-button>
      </div>

      <div *ngIf="esMaitre && !esAdmin" class="registro-selector">
        <ion-button size="small" [color]="tipoRegistro==='cliente' ? 'success' : 'medium'" (click)="setTipoRegistro('cliente')">Cliente</ion-button>
      </div>

      <div *ngIf="esCocinero && !esAdmin && !esMaitre" class="registro-selector">
        <!-- BEBIDA O PLATO - Solo cocineros pueden registrar platos -->
        <ion-button size="small" [color]="tipoRegistro==='producto' ? 'success' : 'medium'" (click)="setTipoRegistro('producto')">Plato</ion-button>
      </div>

      <div *ngIf="esBartender && !esAdmin && !esMaitre" class="registro-selector">
        <!-- BEBIDA O PLATO - Solo bartenders pueden registrar bebidas -->
        <ion-button size="small" [color]="tipoRegistro==='bebida' ? 'success' : 'medium'" (click)="setTipoRegistro('bebida')">Bebida</ion-button>
      </div>

      <!-- Usuarios anónimos (sin login) solo pueden registrar clientes -->
      <div *ngIf="!esAdmin && !esMaitre && !esCocinero && !esBartender" class="registro-selector">
        <ion-button size="small" [color]="tipoRegistro==='cliente' ? 'success' : 'medium'" (click)="setTipoRegistro('cliente')">Cliente</ion-button>
      </div>

      <div class="register-link">
        <a *ngIf="!estaAutenticado" (click)="irAlLogin()">¿Ya tenés cuenta? Iniciar sesión</a>
        <br *ngIf="!estaAutenticado">
        <a (click)="irAlLogin()">Volver al Login</a>
      </div>
    </div>
  </div>
</ion-content>