<ion-header>
  <ion-toolbar color="fritos-blue">
    <ion-title>Gestión de Mesas (Maître)</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="cargarDatos()">
        <ion-icon name="sync-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="mesas-page fritos-theme" [fullscreen]="true">
  
  <div class="maitre-grid">

    <div class="panel espera-panel">
      <h3 class="panel-title ion-padding-horizontal">Clientes en Espera ({{ clientesEspera.length }})</h3>

      <ion-list lines="none" class="ion-no-padding">
        <ion-item 
          *ngFor="let cliente of clientesEspera" 
          (click)="seleccionarCliente(cliente)"
          [class.item-selected]="clienteSeleccionado?.id === cliente.id"
          class="cliente-item"
        >
          <ion-icon slot="start" name="person-circle-outline"></ion-icon>
          <ion-label>
            <h2>{{ cliente.nombre }}</h2>
            <p>Ingreso: {{ cliente.fecha_ingreso | date:'shortTime' }}</p>
          </ion-label>
        </ion-item>
        <ion-item *ngIf="clientesEspera.length === 0" lines="full">
            <ion-label class="ion-text-center ion-padding">
                <p>No hay clientes esperando. ¡Genial!</p>
            </ion-label>
        </ion-item>
      </ion-list>
    </div>

    <div class="panel mesas-panel ion-padding">
      <h3 class="panel-title">Mesas del Local ({{ mesas.length }})</h3>
      <div class="mesas-scroll-area">
        <ion-grid>
          <ion-row>
            @for (mesa of mesas; track mesa.numero) {
                <ion-col size="6" size-md="4" size-lg="3">
                    <ion-card 
                      (click)="seleccionarMesa(mesa)"
                      [class.mesa-disponible]="!mesa.ocupada"
                      [class.mesa-ocupada]="mesa.ocupada"
                      [class.mesa-selected]="mesaSeleccionada?.numero === mesa.numero"
                    >
                      <ion-card-header>
                        <ion-card-title>Mesa N° {{ mesa.numero }}</ion-card-title>
                        <ion-card-subtitle>{{ mesa.tipo }} ({{ mesa.comensales }} Pax)</ion-card-subtitle>
                      </ion-card-header>
                    </ion-card>
                </ion-col>
            }
          </ion-row>
        </ion-grid>
      </div>
    </div>
    
    <div class="asignacion-panel ion-padding-horizontal">
          <ion-item lines="none" class="ion-no-padding">
              <ion-label class="ion-text-wrap">
                  <p class="ion-text-uppercase">Cliente: <strong>{{ clienteSeleccionado?.nombre || 'Ninguno' }}</strong></p>
                  <p class="ion-text-uppercase">Mesa: <strong>{{ mesaSeleccionada?.numero || 'Ninguna' }}</strong></p>
              </ion-label>
          </ion-item>
          
          <ion-button 
            expand="block" 
            color="success" 
            [disabled]="!clienteSeleccionado || !mesaSeleccionada"
            (click)="asignarMesa()"
          >
            <ion-icon name="send-outline" slot="start"></ion-icon>
            ASIGNAR MESA Y NOTIFICAR
          </ion-button>
    </div>

  </div>
</ion-content>