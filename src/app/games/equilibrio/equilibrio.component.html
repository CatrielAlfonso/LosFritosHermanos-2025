<ion-content fullscreen>
  <div class="game-wrapper">
    
    <!-- âœ… PANTALLA DE INICIO MEJORADA -->
    <div class="inicio-screen" *ngIf="state === 'idle'">
      <h1>ğŸ½ï¸ Juego del Mozo</h1>
      
      <!-- Mensaje segÃºn elegibilidad -->
      <p class="estado-mensaje" 
         [class.puede-ganar]="puedeJugarPorDescuento"
         [class.sin-descuento]="!puedeJugarPorDescuento">
        {{ getMensajeInicio() }}
      </p>
      
      <p class="instrucciones">
        Inclina tu dispositivo (o usa las flechas del teclado) para llevar la bandeja a la mesa sin chocar los obstÃ¡culos
      </p>
      
      <ion-button 
        expand="block" 
        [color]="puedeJugarPorDescuento ? 'success' : 'primary'"
        (click)="startGame()">
        <ion-icon name="game-controller-outline" slot="start"></ion-icon>
        {{ puedeJugarPorDescuento ? 'Jugar por ' + descuentoObtenido + '%' : 'Jugar' }}
      </ion-button>
      
      <ion-button 
        expand="block" 
        fill="outline" 
        color="light"
        (click)="volverAjuegos()">
        <ion-icon name="arrow-back-outline" slot="start"></ion-icon>
        Volver
      </ion-button>
    </div>

    <!-- âœ… MENSAJE DE RESULTADO MEJORADO -->
    <div *ngIf="state === 'lost' || state === 'won'" class="mensaje-overlay">
      <div class="mensaje-contenido">
        <h2 [class.ganaste]="state === 'won'" [class.perdiste]="state === 'lost'">
          {{ mensaje }}
        </h2>
        
        <!-- Mostrar descuento solo si realmente se aplicÃ³ -->
        <div class="resultado-info" *ngIf="state === 'won'">
          <div *ngIf="deberMostrarDescuento()" class="descuento-ganado">
            <h3>ğŸ‰ Descuento Obtenido:</h3>
            <p class="porcentaje">{{ descuentoObtenido }}%</p>
          </div>
          
          <div *ngIf="!deberMostrarDescuento() && yaUsoIntento" class="sin-descuento">
            <p>ğŸ® Â¡Gran partida! Este intento fue por diversiÃ³n.</p>
          </div>
        </div>
        
        <div class="resultado-info" *ngIf="state === 'lost'">
          <div *ngIf="puedeJugarPorDescuento" class="intento-perdido">
            <p>ğŸ˜” No alcanzaste el descuento en este intento</p>
          </div>
        </div>
        
        <!-- Mensaje contextual -->
        <div class="mensaje-desc" *ngIf="mensajeResultado">
          <p>{{ mensajeResultado }}</p>
        </div>
        
        <!-- Botones de acciÃ³n -->
        <ion-button 
          expand="block" 
          color="secondary"
          (click)="startGame()">
          <ion-icon name="refresh-outline" slot="start"></ion-icon>
          Jugar de nuevo
        </ion-button>
        
        <ion-button 
          expand="block" 
          fill="outline"
          color="medium"
          (click)="volverAjuegos()">
          <ion-icon name="arrow-back-outline" slot="start"></ion-icon>
          Volver al MenÃº de Juegos
        </ion-button>
      </div>
    </div>

    <div class="game-area" #gameArea>
      <!-- Mozo -->
      <div
        class="mozo"
        [style.transform]="'translate(' + mozo.x + 'px,' + mozo.y + 'px)'">
      </div>

      <!-- Mesa -->
      <div
        class="mesa"
        [style.transform]="'translate(' + mesa.x + 'px,' + mesa.y + 'px)'">
      </div>

      <!-- ObstÃ¡culos -->
      <div
        class="obstaculo"
        *ngFor="let o of obstacles"
        [ngClass]="o.type"
        [style.transform]="'translate(' + o.x + 'px,' + o.y + 'px)'">
      </div>
    </div>
  </div>
</ion-content>