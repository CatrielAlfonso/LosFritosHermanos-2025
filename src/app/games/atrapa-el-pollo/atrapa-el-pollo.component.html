<!-- <ion-content [fullscreen]="true" class="juego-container">
  
  <div class="game-area" (click)="onAction($event)">

    <div class="game-overlay" *ngIf="!juegoActivo">
      <h1 class="fritos-logo">Â¡El Atrapa-Pollo!</h1>
      <p class="fritos-subtitle">Haz clic o presiona ESPACIO para saltar y llegar a la meta.</p>
      <ion-button color="fritos-red" (click)="iniciarJuego()">
        Comenzar (Primer Intento)
      </ion-button>
    </div>

    <div class="pollo" [style.transform]="polloStyle">
      <ion-icon name="happy-outline" class="pollo-icon"></ion-icon>
    </div>

    <div 
      class="meta" 
      [style.left]="(metaDistancia - distanciaRecorrida) * 0.1 + 'px'"
      [style.width]="metaAncho + 'px'"
    >
      <ion-icon name="cube-outline" class="meta-icon"></ion-icon>
    </div>

    <div class="score-display">
      Distancia: {{ distanciaRecorrida }} / {{ metaDistancia }}
    </div>

    </div>

</ion-content> -->

<ion-content [fullscreen]="true" class="juego-container">
  
  <div class="game-area" (click)="onAction($event)">
    
     <!-- PANTALLA DE INICIO (gameState === 'inicio') -->
    <div class="game-overlay" *ngIf="gameState === 'inicio'">
      <h1 class="fritos-logo">ğŸ— Â¡Crispy el Atrapa-Pollo!</h1>
      
      <!-- Mensaje segÃºn elegibilidad -->
      <p class="fritos-subtitle estado-mensaje" 
         [class.puede-ganar]="puedeJugarPorDescuento"
         [class.sin-descuento]="!puedeJugarPorDescuento">
        {{ getMensajeInicio() }}
      </p>
      
      <p>Instrucciones: Haz clic para saltar y esquivar los obstÃ¡culos.</p>
      
      <ion-button expand="block" [color]="puedeJugarPorDescuento ? 'success' : 'primary'" (click)="iniciarJuego()">
        <ion-icon name="game-controller-outline" slot="start"></ion-icon>
        {{ puedeJugarPorDescuento ? 'Comenzar (Intento por Descuento)' : 'Jugar' }}
      </ion-button>
      
      <ion-button expand="block" fill="outline" color="medium" (click)="volverAlHome()">
        <ion-icon name="arrow-back-outline" slot="start"></ion-icon>
        Volver
      </ion-button>
    </div>

    <!-- PANTALLA DE RESULTADO (gameState === 'terminado') -->
    <!-- PANTALLA DE RESULTADO (gameState === 'terminado') -->
<!-- PANTALLA DE RESULTADO (gameState === 'terminado') - CORREGIDA -->
<div class="game-overlay resultado-final" *ngIf="gameState === 'terminado'">
    <h1 class="fritos-logo">
        {{ resultadoFinal.exito ? 'ğŸ‰ Â¡GANASTE!' : 'ğŸ”¥ Game Over' }}
    </h1>
    
    <div class="score-card">
        <h2 class="fritos-subtitle">Paredes Pasadas:</h2>
        <p class="data-score">{{ paredesPasadas }} / {{ totalParedes }}</p>
        
        <!-- âœ… CORRECCIÃ“N: Solo mostrar descuento si realmente se aplicÃ³ -->
        @if (this.deberMostrarDescuento()) {
          <h2 class="fritos-subtitle">ğŸ‰ Descuento Obtenido:</h2>
          <p class="data-desc ganado">{{ resultadoFinal.porcentaje }}%</p>
          
          <div class="nivel-alcanzado">
            @if (paredesPasadas >= 8) {
              <p>âœ¨ Â¡Nivel Maestro! - 20% de descuento</p>
            } @else if (paredesPasadas >= 5) {
              <p>ğŸŒŸ Â¡Nivel Avanzado! - 15% de descuento</p>
            } @else if (paredesPasadas >= 3) {
              <p>â­ Â¡Nivel BÃ¡sico! - 10% de descuento</p>
            }
          </div>
        } @else if (puedeJugarPorDescuento && resultadoFinal.porcentaje === 0) {
          <!-- Primer intento pero no alcanzÃ³ descuento -->
          <p class="mensaje-sin-descuento">
            ğŸ’ª Â¡NecesitÃ¡s pasar al menos 3 paredes para ganar descuento!
          </p>
        } @else if (yaUsoIntento) {
          <!-- Ya usÃ³ su intento (segundo juego o mÃ¡s) -->
          <p class="mensaje-info">
            ğŸ® Â¡Gran partida! Este intento fue por diversiÃ³n.
          </p>
        }
    </div>
    
    <!-- âœ… CORRECCIÃ“N: Mensaje contextual correcto -->
    <div class="mensaje-desc">
        @if (mensajeResultado) {
          <p>{{ mensajeResultado }}</p>
        }
    </div>

    <!-- Botones de acciÃ³n -->
    <ion-button expand="block" color="secondary" (click)="reiniciarJuego()">
        <ion-icon name="refresh-outline" slot="start"></ion-icon>
        Jugar de Nuevo
    </ion-button>
    
    <ion-button expand="block" fill="outline" color="medium" (click)="volverAlHome()">
        <ion-icon name="arrow-back-outline" slot="start"></ion-icon>
        Volver al MenÃº de Juegos
    </ion-button>
</div>

    <!-- <div class="game-overlay" *ngIf="!juegoActivo">
      </div> -->

    <!-- Contenedor del juego (Visible en 'jugando') -->
    <ng-container *ngIf="gameState === 'jugando'">
        <!-- Crispy (El Pollo) -->
        <div class="pollo" [style.transform]="polloStyle">
            <img src="../../../assets/imgs/crispy2.png" alt="Crispy el Pollo" class="crispy-img">
        </div>

        <!-- ObstÃ¡culos (Columnas) -->
        @for (obs of obstaculos; track obs.id) {
          <div class="obstaculo-columna" [style.left]="obs.x + 'px'">
            
            <!-- Columna Superior -->
            <div 
              class="obstaculo-parte" 
              [style.height]="(obs.huecoY - obs.huecoAltura/2) + 'vh'"
              [style.top]="'0'"
            ></div>
            
            <!-- Columna Inferior -->
            <div 
              class="obstaculo-parte" 
              [style.height]="(100 - (obs.huecoY + obs.huecoAltura/2)) + 'vh'"
              [style.bottom]="'0'"
            ></div>
          </div>
        }

        <!-- Indicador de PuntuaciÃ³n/Distancia (Opcional) -->
        <div class="score-display">
          Paredes Pasadas: {{ paredesPasadas }}
        </div>
    </ng-container>

  </div>

</ion-content>